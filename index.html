<!DOCTYPE html>
<html>
<head>
    
    <title>Ashfall</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="css/site.css" />
    <script src="js/jquery-3.1.1.min.js"></script>
    <link rel="stylesheet" href="js/leaflet/leaflet.css" />
    <script src="js/leaflet/leaflet.js"></script>
    <script src="js/d3/d3.min.js"></script>
    <script src="js/aep-mapping.js"></script>
</head>
<body>


<h1>AEP</h1>
<div class="choices-row">
    <span class="choices-title">Country: <br><small>(ctrl click to select more than one country)</small></span>
    <span class="map-option">
        <select id="countries" multiple size="5" class="map-option">
            <optgroup label="Africa">
                <option value="sudan,uganda,southafrica" class="country-group">All Africa</option>
                <option value="sudan" selected>Sudan</option>
                <option value="uganda">Uganda</option>
                <option value="southafrica">South Africa</option>
            </optgroup>
        </select>
    </span>
</div>
<div class="choices-row">
    <span class="choices-title">Threshold:</span>
    <span class="map-option">
        <select id="threshold">
            <option value="0.1">0.1</option>
            <option value="1">1.0</option>
            <option value="10">10.0</option>
            <option value="100">100.0</option>
            <option value="1000">1,000.0</option>
            <option value="10000">10,000.0</option>
        </select>
    </span>
</div>
<div class="choices-row">
    <span class="choices-title">Colour scheme:</span>
    <span class="map-option">
        <select id="colourscheme">
            <option value="hot">MatPlotLib Hot</option>
            <option value="viridis">MatPlotLib Viridis</option>
            <option value="jet">MatPlotLib Jet</option>
            <option value="magma">MatPlotLib Magma</option>
            <option value="inferno">MatPlotLib Inferno</option>
            <option value="plasma">MatPlotLib Plasma</option>
        </select>
    </span>
</div>
<div id="map" class="map left"></div>
<div id="color-scale" class="colorscale"></div>
<div id="data-details" class="data-text"></div>

<script>
    $(document).ready(function () {
        function getCountriesSelection () {
            // Gets the selected countries as an array
            var countries = d3.set();
            // Choices list can have single countries,
            // or comma separated lists of countries
            $.each($("#countries").val(), function (i, selectedVal) {
                // Find comma separated lists of countries in
                // selected option
                $.each(selectedVal.split(","), function (i, country) {
                    countries.add(country);
                });
            });
            return countries.values();
        }

        var defaultCountries = getCountriesSelection(),
            defaultThreshold = parseFloat($("#threshold").val()),
            defaultColourScheme = $("#colourscheme").val();

        function drawMap (countries, threshold, colourScheme) {
            console.log(countries, threshold, colourScheme);
            Ashfall.maps.drawMap('map', 'color-scale', 'data-details', countries, threshold, colourScheme);
        }

        function redrawMap () {
            var countries = getCountriesSelection(),
                threshold = parseFloat($("#threshold").val()),
                colourScheme = $("#colourscheme").val();
            drawMap(countries, threshold, colourScheme);
        }

        // Set up event handlers for changes to selections
        $(".map-option").on("change", function( event ) {
            redrawMap();
        });

        // Draw the default map (when page first loads)
        drawMap(defaultCountries, defaultThreshold, defaultColourScheme);
    });
    
</script>



</body>
</html>
